<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OIKOS Analytics Portal</title>
    <link rel="icon" type="image/png" href="https://oikos.com.co/wp-content/uploads/2021/01/cropped-Favicon-Oikos-32x32.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@600;800&family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root { --primary-blue: #004a99; --deep-blue: #003366; --accent-cyan: #00d2ff; --text-gray: #64748b; }
        
        body, html { 
            font-family: 'DM Sans', sans-serif; 
            background: linear-gradient(135deg, #f0f4ff 0%, #e8ecf9 100%); 
            height: 100%; width: 100%; display: flex; align-items: center; justify-content: center; 
            position: relative; overflow: hidden; 
        }

        .circle-decoration { position: absolute; border-radius: 50%; opacity: 0.15; z-index: 0; filter: blur(50px); }
        .c1 { width: 300px; height: 300px; background: var(--primary-blue); top: -100px; left: -100px; animation: float 10s infinite; }
        .c2 { width: 400px; height: 400px; background: var(--accent-cyan); bottom: -150px; right: -150px; animation: float 12s infinite reverse; }
        @keyframes float { 0%, 100% { transform: translate(0,0); } 50% { transform: translate(20px, 20px); } }

        .container { 
            display: flex; background: white; border-radius: 28px; 
            box-shadow: 0 40px 100px rgba(0, 0, 0, 0.1); 
            max-width: 1000px; width: 92%; min-height: 600px;
            position: relative; z-index: 1; overflow: hidden;
            animation: slideUp 0.8s ease-out;
        }
        @keyframes slideUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }

        .login-section { flex: 1.2; padding: 50px 60px; display: flex; flex-direction: column; justify-content: center; }
        .brand-name { font-family: 'Outfit', sans-serif; font-size: 32px; font-weight: 800; color: var(--primary-blue); margin-bottom: 40px; letter-spacing: -1px; }
        h2 { font-family: 'Outfit', sans-serif; font-size: 26px; color: #1e293b; margin-bottom: 12px; }
        .instruction { font-size: 13px; color: var(--text-gray); margin-bottom: 25px; line-height: 1.5; }

        .input-wrapper { display: flex; align-items: center; background: #f8fafc; border: 2px solid #e2e8f0; border-radius: 14px; transition: 0.3s; margin-bottom: 15px; }
        .input-wrapper input { flex: 1; padding: 18px; border: none; background: transparent; outline: none; font-size: 15px; color: #1e293b; }

        .btn-request { width: 100%; padding: 12px; background: white; color: var(--primary-blue); border: 2px solid var(--primary-blue); border-radius: 12px; font-weight: 700; cursor: pointer; margin-bottom: 15px; font-size: 12px; transition: 0.3s; }
        .btn-request:hover { background: #f0f7ff; }

        .main-button { width: 100%; padding: 18px; background: var(--primary-blue); color: white; border: none; border-radius: 14px; font-weight: 700; font-family: 'Outfit', sans-serif; cursor: pointer; transition: 0.3s; box-shadow: 0 10px 25px rgba(0, 74, 153, 0.2); margin-bottom: 12px; }
        .main-button:hover { background: var(--deep-blue); transform: translateY(-2px); }

        .welcome-section { flex: 1; background: linear-gradient(150deg, var(--primary-blue) 0%, var(--deep-blue) 100%); padding: 60px; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; color: white; }
        .welcome-section h1 { font-family: 'Outfit', sans-serif; font-size: 44px; margin-bottom: 20px; }
        .welcome-section p { font-size: 15px; opacity: 0.8; line-height: 1.6; max-width: 280px; }

        #bi-container { 
            display: none; 
            position: fixed; 
            top: 0; left: 0; 
            width: 100vw; height: 100vh; 
            z-index: 99999; 
            background: white; 
        }

        /* BOTÓN HOME - MÁS ANCHO, ADAPTATIVO Y MÁS A LA IZQUIERDA */
        #btn-home {
            position: absolute;
            bottom: 12px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 100001;
            padding: 10px 24px;
            background: var(--primary-blue);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 700;
            font-family: 'Outfit', sans-serif;
            cursor: pointer;
            transition: 0.3s;
            box-shadow: 0 4px 12px rgba(0, 74, 153, 0.4);
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
            min-width: 120px;
        }
        #btn-home:hover {
            background: var(--deep-blue);
            transform: translateX(-50%) translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 74, 153, 0.5);
        }
        #btn-home svg {
            width: 18px;
            height: 18px;
            fill: white;
        }

        /* RESPONSIVE */
        @media (max-width: 768px) {
            #btn-home {
                padding: 8px 16px;
                font-size: 12px;
                min-width: 100px;
            }
            #btn-home svg {
                width: 16px;
                height: 16px;
            }
        }

        .shield { 
            position: absolute; 
            z-index: 100000; 
            background: rgba(255, 255, 255, 0.01); 
            cursor: pointer; 
        }
        #shield-top-right { 
            top: 0; 
            right: 0; 
            width: 180px; 
            height: 55px; 
        } 
        #shield-bottom-right { 
            bottom: 0; 
            right: 0; 
            width: 250px; 
            height: 45px; 
        }

        iframe { width: 100%; height: 100%; border: none; display: block; }
        #status-msg { margin-top: 15px; font-size: 12px; text-align: center; font-weight: 600; }
    </style>
</head>
<body>
    <div class="circle-decoration c1"></div>
    <div class="circle-decoration c2"></div>

    <div class="container" id="login-ui">
        <div class="login-section">
            <div class="brand-name">OIKOS</div>
            <h2>Acceso al Portal</h2>
            <p class="instruction">Introduce tu correo y clave. Si ya ingresaste hoy, tu sesión estará activa por 6 horas.</p>
            
            <div class="input-wrapper">
                <input type="email" id="email" placeholder="ejemplo@oikos.com.co" spellcheck="false">
            </div>
            
            <button class="btn-request" onclick="requestToken()">VALIDAR USUARIO</button>

            <div class="input-wrapper">
                <input type="text" id="token" placeholder="Clave Alfanumérica" maxlength="6">
            </div>
            
            <button class="main-button" onclick="verifyToken()">INGRESAR AL SISTEMA</button>
            <div id="status-msg"></div>
        </div>
        <div class="welcome-section">
            <h1>Analytics</h1>
            <p>Grupo Empresarial OIKOS S.A.S</p>
        </div>
    </div>

    <div id="bi-container">
        <button id="btn-home" onclick="volverHome()">
            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
            </svg>
            HOME
        </button>
        <div id="shield-top-right" class="shield" onclick="securityReset()"></div>
        <div id="shield-bottom-right" class="shield" onclick="securityReset()"></div>
        <iframe id="bi-frame" src=""></iframe>
    </div>

    <script>
        const API_URL = "https://script.google.com/macros/s/AKfycbzvsSjroWeRF9XZnWtdLLHGbj3luxszPObIwwPdMDTNCWdmjvDYWF2fnO9i0AfRdrvYbA/exec";
        const REPO_URL = "https://analistadatos-oikos.github.io/Repositorios_Visuales_BI/";

        window.onload = () => {
            const savedSession = JSON.parse(localStorage.getItem('oikos_auth_token'));
            if(savedSession) {
                const now = new Date().getTime();
                if(now - savedSession.time < 21600000) {
                    showReportSelector(savedSession.reportes);
                }
            }
        };

        function volverHome() {
            document.getElementById('bi-container').style.display = 'none';
            document.getElementById('bi-frame').src = '';
            document.getElementById('login-ui').style.display = 'flex';
            
            const savedSession = JSON.parse(localStorage.getItem('oikos_auth_token'));
            if(savedSession && savedSession.reportes.length > 1) {
                showReportSelector(savedSession.reportes);
            } else {
                window.location.reload();
            }
        }

        function securityReset() {
            alert("Acción no permitida por seguridad corporativa.");
            window.location.href = REPO_URL;
        }

        function setStatus(m, c = "#64748b") {
            const el = document.getElementById('status-msg');
            el.innerText = m; el.style.color = c;
        }

        async function requestToken() {
            const mail = document.getElementById('email').value;
            if(!mail.includes('@')) return setStatus("Correo no válido", "#ef4444");
            setStatus("Enviando clave...", "#004a99");
            try {
                const res = await fetch(`${API_URL}?action=solicitar&correo=${encodeURIComponent(mail)}`);
                const data = await res.json();
                if(data.status === 'sent') setStatus("¡Clave enviada! Válida por 6h.", "#10b981");
                else setStatus(data.message, "#ef4444");
            } catch(e) { setStatus("Error de red", "#ef4444"); }
        }

        async function verifyToken() {
            const mail = document.getElementById('email').value;
            const tk = document.getElementById('token').value;
            if(!mail || !tk) return setStatus("Completa los datos", "#ef4444");
            setStatus("Verificando acceso...", "#004a99");
            try {
                const res = await fetch(`${API_URL}?action=validar&correo=${encodeURIComponent(mail)}&token=${encodeURIComponent(tk)}`);
                const data = await res.json();
                if(data.status === 'success') {
                    localStorage.setItem('oikos_auth_token', JSON.stringify({
                        time: new Date().getTime(),
                        reportes: data.reportes
                    }));
                    showReportSelector(data.reportes);
                } else setStatus(data.message, "#ef4444");
            } catch(e) { setStatus("Falla de validación", "#ef4444"); }
        }

        function showReportSelector(reportes) {
            if(reportes.length === 1) {
                loadReport(reportes[0].url);
                return;
            }

            document.getElementById('login-ui').innerHTML = `
                <div class="login-section" style="text-align: center;">
                    <div class="brand-name">OIKOS Analytics</div>
                    <h2>Selecciona tu Reporte</h2>
                    <p class="instruction">Elige el dashboard que deseas visualizar</p>
                    <div id="buttons-container" style="display: flex; flex-direction: column; margin-top: 30px;">
                        ${reportes.map(r => `
                            <button class="main-button" onclick="loadReport('${r.url}')">
                                ${r.nombre}
                            </button>
                        `).join('')}
                    </div>
                </div>
                <div class="welcome-section">
                    <h1>Analytics</h1>
                    <p>Grupo Empresarial OIKOS S.A.S</p>
                </div>
            `;
            document.getElementById('login-ui').style.display = 'flex';
        }

        function loadReport(url) {
            document.getElementById('login-ui').style.display = 'none';
            document.getElementById('bi-container').style.display = 'block';
            document.getElementById('bi-frame').src = url;
        }
    </script>
</body>
</html>


